package pagedata

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

var (
	text = `<gradex-pagedata>{"current":{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0001-me1.pdf","UUID":"886a7ad3-728f-453a-83ec-aa09d0054665","number":1,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0001.pdf","UUID":"5c61bef0-2409-4025-8f40-fcf39a360071","number":1,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"merge","UUID":"4db1f0e6-c9c0-4555-a851-92df14959419","unixTime":1590533315414999682,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"8ec83f14-97f1-41d6-b031-3238c2016825","follows":"79c6eeb2-5589-4a91-9edf-1d6b074625db","revision":0,"data":[{"k":"tf-subtotal-02","v":""},{"k":"tf-q1-number","v":"1"},{"k":"tf-q2-section","v":""},{"k":"tf-q1-section","v":"A"},{"k":"tf-subtotal-10","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-subtotal-06","v":""},{"k":"tf-subtotal-15","v":""},{"k":"tf-subtotal-07","v":""},{"k":"tf-subtotal-05","v":""},{"k":"tf-q2-number","v":""},{"k":"tf-page-bad","v":""},{"k":"tf-subtotal-11","v":""},{"k":"tf-q1-mark","v":"6/12"},{"k":"tf-subtotal-14","v":""},{"k":"tf-subtotal-08","v":""},{"k":"tf-subtotal-13","v":""},{"k":"tf-subtotal-09","v":"3/6"},{"k":"tf-page-ok","v":"X"},{"k":"tf-subtotal-01","v":""},{"k":"tf-subtotal-00","v":"1/2"},{"k":"tf-subtotal-04","v":"2/4"},{"k":"tf-subtotal-03","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-00-optical","v":"mark-detected"},{"k":"tf-subtotal-01-optical","v":""},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":""},{"k":"tf-subtotal-04-optical","v":"mark-detected"},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":""},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":""},{"k":"tf-subtotal-09-optical","v":"mark-detected"},{"k":"tf-subtotal-10-optical","v":""},{"k":"tf-subtotal-11-optical","v":""},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":""},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":""},{"k":"tf-q1-section-optical","v":"mark-detected"},{"k":"tf-q1-number-optical","v":"mark-detected"},{"k":"tf-q1-mark-optical","v":"mark-detected"},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":"mark-detected"}],"comments":[{"Pos":{"x":118.446,"y":688.9},"Text":"The marker commented here (1)","Page":0,"Label":"0-TDD"},{"Pos":{"x":369.39,"y":382.683},"Text":"the marker also commented here (2)\r","Page":0,"Label":"1-TDD"}]},"previous":[{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200001.pdf","UUID":"4157b97d-3f52-4d5d-9128-7886ec3cdb4f","number":1,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":1,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten","UUID":"97294dd3-485c-4a8f-ba2b-d13c5a8d5ee6","unixTime":1590223559068470742,"for":"ingester","toDo":"prepare-for-marking","by":"gradex-cli","data":null},"UUID":"b01b97ff-1e10-4808-b5bc-e36685337e80","follows":"","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200001.pdf","UUID":"4157b97d-3f52-4d5d-9128-7886ec3cdb4f","number":1,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":1,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"mark-bar","UUID":"4a3c6618-fab6-43a2-b8af-4a1ad8c672b1","unixTime":1590223560790746684,"for":"tddrysdale","toDo":"marking","by":"gradex-cli","data":null},"UUID":"eaae8aff-8d23-47d5-8841-8563565b5de3","follows":"b01b97ff-1e10-4808-b5bc-e36685337e80","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0001.pdf","UUID":"5c61bef0-2409-4025-8f40-fcf39a360071","number":1,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200001.pdf","UUID":"4157b97d-3f52-4d5d-9128-7886ec3cdb4f","number":1,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten-processed-papers","UUID":"9118add4-d8ad-4d29-8de0-1f3b0f529ca0","unixTime":1590533311918317333,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"79c6eeb2-5589-4a91-9edf-1d6b074625db","follows":"eaae8aff-8d23-47d5-8841-8563565b5de3","revision":0,"data":[{"k":"tf-subtotal-02","v":""},{"k":"tf-q1-number","v":"1"},{"k":"tf-q2-section","v":""},{"k":"tf-q1-section","v":"A"},{"k":"tf-subtotal-10","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-subtotal-06","v":""},{"k":"tf-subtotal-15","v":""},{"k":"tf-subtotal-07","v":""},{"k":"tf-subtotal-05","v":""},{"k":"tf-q2-number","v":""},{"k":"tf-page-bad","v":""},{"k":"tf-subtotal-11","v":""},{"k":"tf-q1-mark","v":"6/12"},{"k":"tf-subtotal-14","v":""},{"k":"tf-subtotal-08","v":""},{"k":"tf-subtotal-13","v":""},{"k":"tf-subtotal-09","v":"3/6"},{"k":"tf-page-ok","v":"X"},{"k":"tf-subtotal-01","v":""},{"k":"tf-subtotal-00","v":"1/2"},{"k":"tf-subtotal-04","v":"2/4"},{"k":"tf-subtotal-03","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-00-optical","v":"mark-detected"},{"k":"tf-subtotal-01-optical","v":""},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":""},{"k":"tf-subtotal-04-optical","v":"mark-detected"},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":""},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":""},{"k":"tf-subtotal-09-optical","v":"mark-detected"},{"k":"tf-subtotal-10-optical","v":""},{"k":"tf-subtotal-11-optical","v":""},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":""},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":""},{"k":"tf-q1-section-optical","v":"mark-detected"},{"k":"tf-q1-number-optical","v":"mark-detected"},{"k":"tf-q1-mark-optical","v":"mark-detected"},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":"mark-detected"}],"comments":[{"Pos":{"x":118.446,"y":688.9},"Text":"The marker commented here (1)","Page":0,"Label":"0-TDD"},{"Pos":{"x":369.39,"y":382.683},"Text":"the marker also commented here (2)\r","Page":0,"Label":"1-TDD"}]}]}</gradex-pagedata><hash>1373610917</hash>
----
<gradex-pagedata>{"current":{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0002-me1.pdf","UUID":"bc8c2d4f-5bce-4a40-9e51-f89fcbdc9991","number":2,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0002.pdf","UUID":"5e2c0b60-440a-4e7f-978e-83ff38f4c9f5","number":2,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"merge","UUID":"4db1f0e6-c9c0-4555-a851-92df14959419","unixTime":1590533315414999682,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"4e4bc2b8-3824-491f-a499-fe32ea5f5272","follows":"84b252fd-78a2-4b54-bd20-4b84ac950539","revision":0,"data":[{"k":"tf-subtotal-13","v":""},{"k":"tf-subtotal-05","v":""},{"k":"tf-q1-section","v":""},{"k":"tf-subtotal-09","v":""},{"k":"tf-subtotal-02","v":""},{"k":"tf-subtotal-01","v":""},{"k":"tf-subtotal-10","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-q2-section","v":""},{"k":"tf-subtotal-03","v":""},{"k":"tf-subtotal-04","v":""},{"k":"tf-subtotal-08","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-subtotal-07","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-11","v":""},{"k":"tf-q1-mark","v":""},{"k":"tf-subtotal-14","v":""},{"k":"tf-subtotal-06","v":""},{"k":"tf-subtotal-00","v":""},{"k":"tf-q1-number","v":""},{"k":"tf-subtotal-15","v":""},{"k":"tf-page-ok","v":""},{"k":"tf-page-bad","v":"X"},{"k":"tf-q2-number","v":""},{"k":"tf-subtotal-00-optical","v":""},{"k":"tf-subtotal-01-optical","v":""},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":""},{"k":"tf-subtotal-04-optical","v":""},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":""},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":""},{"k":"tf-subtotal-09-optical","v":""},{"k":"tf-subtotal-10-optical","v":""},{"k":"tf-subtotal-11-optical","v":""},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":""},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":"mark-detected"},{"k":"tf-q1-section-optical","v":""},{"k":"tf-q1-number-optical","v":""},{"k":"tf-q1-mark-optical","v":""},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":""}],"comments":null},"previous":[{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200002.pdf","UUID":"90662564-b44d-4037-9647-e440367c0bc5","number":2,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":2,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten","UUID":"97294dd3-485c-4a8f-ba2b-d13c5a8d5ee6","unixTime":1590223559068470742,"for":"ingester","toDo":"prepare-for-marking","by":"gradex-cli","data":null},"UUID":"837aa50b-9818-44a7-b451-bc38e120891a","follows":"","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200002.pdf","UUID":"90662564-b44d-4037-9647-e440367c0bc5","number":2,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":2,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"mark-bar","UUID":"4a3c6618-fab6-43a2-b8af-4a1ad8c672b1","unixTime":1590223560790746684,"for":"tddrysdale","toDo":"marking","by":"gradex-cli","data":null},"UUID":"2990526f-c383-484d-abe8-2ff88b571ba7","follows":"837aa50b-9818-44a7-b451-bc38e120891a","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0002.pdf","UUID":"5e2c0b60-440a-4e7f-978e-83ff38f4c9f5","number":2,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200002.pdf","UUID":"90662564-b44d-4037-9647-e440367c0bc5","number":2,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten-processed-papers","UUID":"9118add4-d8ad-4d29-8de0-1f3b0f529ca0","unixTime":1590533311918317333,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"84b252fd-78a2-4b54-bd20-4b84ac950539","follows":"2990526f-c383-484d-abe8-2ff88b571ba7","revision":0,"data":[{"k":"tf-subtotal-13","v":""},{"k":"tf-subtotal-05","v":""},{"k":"tf-q1-section","v":""},{"k":"tf-subtotal-09","v":""},{"k":"tf-subtotal-02","v":""},{"k":"tf-subtotal-01","v":""},{"k":"tf-subtotal-10","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-q2-section","v":""},{"k":"tf-subtotal-03","v":""},{"k":"tf-subtotal-04","v":""},{"k":"tf-subtotal-08","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-subtotal-07","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-11","v":""},{"k":"tf-q1-mark","v":""},{"k":"tf-subtotal-14","v":""},{"k":"tf-subtotal-06","v":""},{"k":"tf-subtotal-00","v":""},{"k":"tf-q1-number","v":""},{"k":"tf-subtotal-15","v":""},{"k":"tf-page-ok","v":""},{"k":"tf-page-bad","v":"X"},{"k":"tf-q2-number","v":""},{"k":"tf-subtotal-00-optical","v":""},{"k":"tf-subtotal-01-optical","v":""},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":""},{"k":"tf-subtotal-04-optical","v":""},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":""},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":""},{"k":"tf-subtotal-09-optical","v":""},{"k":"tf-subtotal-10-optical","v":""},{"k":"tf-subtotal-11-optical","v":""},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":""},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":"mark-detected"},{"k":"tf-q1-section-optical","v":""},{"k":"tf-q1-number-optical","v":""},{"k":"tf-q1-mark-optical","v":""},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":""}],"comments":null}]}</gradex-pagedata><hash>3024501029</hash>
---
<gradex-pagedata>{"current":{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0003-me1.pdf","UUID":"e58493a5-e5dc-4c4e-9717-fbc86afe172b","number":3,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0003.pdf","UUID":"1f09bd26-57f2-485e-9b0a-5965eb4406b7","number":3,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"merge","UUID":"4db1f0e6-c9c0-4555-a851-92df14959419","unixTime":1590533315414999682,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"d82d6da4-a282-48aa-a925-c0eef279f094","follows":"6b692632-504b-4669-a1ac-25f6dd50b4e3","revision":0,"data":[{"k":"tf-q2-number","v":""},{"k":"tf-subtotal-03","v":"2"},{"k":"tf-q2-section","v":""},{"k":"tf-subtotal-08","v":"2"},{"k":"tf-subtotal-06","v":"1"},{"k":"tf-subtotal-09","v":""},{"k":"tf-subtotal-00","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-subtotal-13","v":""},{"k":"tf-q1-number","v":"1"},{"k":"tf-page-ok","v":"x"},{"k":"tf-page-bad","v":""},{"k":"tf-q1-section","v":"B"},{"k":"tf-subtotal-04","v":""},{"k":"tf-q1-mark","v":"17"},{"k":"tf-subtotal-11","v":"3"},{"k":"tf-subtotal-07","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-01","v":"2"},{"k":"tf-subtotal-15","v":""},{"k":"tf-subtotal-02","v":""},{"k":"tf-subtotal-14","v":"5"},{"k":"tf-subtotal-05","v":""},{"k":"tf-subtotal-10","v":"2"},{"k":"tf-subtotal-00-optical","v":""},{"k":"tf-subtotal-01-optical","v":"mark-detected"},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":"mark-detected"},{"k":"tf-subtotal-04-optical","v":""},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":"mark-detected"},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":"mark-detected"},{"k":"tf-subtotal-09-optical","v":""},{"k":"tf-subtotal-10-optical","v":"mark-detected"},{"k":"tf-subtotal-11-optical","v":"mark-detected"},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":"mark-detected"},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":""},{"k":"tf-q1-section-optical","v":"mark-detected"},{"k":"tf-q1-number-optical","v":"mark-detected"},{"k":"tf-q1-mark-optical","v":"mark-detected"},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":"mark-detected"}],"comments":null},"previous":[{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200003.pdf","UUID":"850c4d68-f679-4da7-9029-8f4fa99bd991","number":3,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":3,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten","UUID":"97294dd3-485c-4a8f-ba2b-d13c5a8d5ee6","unixTime":1590223559068470742,"for":"ingester","toDo":"prepare-for-marking","by":"gradex-cli","data":null},"UUID":"b8860b12-cc66-40d2-8e24-151246296441","follows":"","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200003.pdf","UUID":"850c4d68-f679-4da7-9029-8f4fa99bd991","number":3,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/03-accepted-papers/s00000000_attempt_2020-04-23-09-51-20.pdf","UUID":"b937398b-63c9-42ed-8d41-bdcbcfbe5abc","number":3,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"mark-bar","UUID":"4a3c6618-fab6-43a2-b8af-4a1ad8c672b1","unixTime":1590223560790746684,"for":"tddrysdale","toDo":"marking","by":"gradex-cli","data":null},"UUID":"df6bdfbb-7e9a-415d-8f7d-4b57fad5acf4","follows":"b8860b12-cc66-40d2-8e24-151246296441","revision":0,"data":null,"comments":null},{"is":"page","own":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/Practice-B999999-maTDD-marked-comments0003.pdf","UUID":"1f09bd26-57f2-485e-9b0a-5965eb4406b7","number":3,"of":3},"original":{"path":"tmp-delete-me/usr/exam/Practice/04-temporary-pages/s00000000_attempt_2020-04-23-09-51-200003.pdf","UUID":"850c4d68-f679-4da7-9029-8f4fa99bd991","number":3,"of":3},"current":{"path":"","UUID":"","number":0,"of":0},"item":{"what":"Practice","when":"23-Apr-2020","who":"B999999","UUID":"","whoType":"anonymous"},"process":{"name":"flatten-processed-papers","UUID":"9118add4-d8ad-4d29-8de0-1f3b0f529ca0","unixTime":1590533311918317333,"for":"ingester","toDo":"further-processing","by":"gradex-cli","data":null},"UUID":"6b692632-504b-4669-a1ac-25f6dd50b4e3","follows":"df6bdfbb-7e9a-415d-8f7d-4b57fad5acf4","revision":0,"data":[{"k":"tf-q2-number","v":""},{"k":"tf-subtotal-03","v":"2"},{"k":"tf-q2-section","v":""},{"k":"tf-subtotal-08","v":"2"},{"k":"tf-subtotal-06","v":"1"},{"k":"tf-subtotal-09","v":""},{"k":"tf-subtotal-00","v":""},{"k":"tf-subtotal-16","v":""},{"k":"tf-subtotal-13","v":""},{"k":"tf-q1-number","v":"1"},{"k":"tf-page-ok","v":"x"},{"k":"tf-page-bad","v":""},{"k":"tf-q1-section","v":"B"},{"k":"tf-subtotal-04","v":""},{"k":"tf-q1-mark","v":"17"},{"k":"tf-subtotal-11","v":"3"},{"k":"tf-subtotal-07","v":""},{"k":"tf-subtotal-12","v":""},{"k":"tf-q2-mark","v":""},{"k":"tf-subtotal-01","v":"2"},{"k":"tf-subtotal-15","v":""},{"k":"tf-subtotal-02","v":""},{"k":"tf-subtotal-14","v":"5"},{"k":"tf-subtotal-05","v":""},{"k":"tf-subtotal-10","v":"2"},{"k":"tf-subtotal-00-optical","v":""},{"k":"tf-subtotal-01-optical","v":"mark-detected"},{"k":"tf-subtotal-02-optical","v":""},{"k":"tf-subtotal-03-optical","v":"mark-detected"},{"k":"tf-subtotal-04-optical","v":""},{"k":"tf-subtotal-05-optical","v":""},{"k":"tf-subtotal-06-optical","v":"mark-detected"},{"k":"tf-subtotal-07-optical","v":""},{"k":"tf-subtotal-08-optical","v":"mark-detected"},{"k":"tf-subtotal-09-optical","v":""},{"k":"tf-subtotal-10-optical","v":"mark-detected"},{"k":"tf-subtotal-11-optical","v":"mark-detected"},{"k":"tf-subtotal-12-optical","v":""},{"k":"tf-subtotal-13-optical","v":""},{"k":"tf-subtotal-14-optical","v":"mark-detected"},{"k":"tf-subtotal-15-optical","v":""},{"k":"tf-subtotal-16-optical","v":""},{"k":"tf-page-bad-optical","v":""},{"k":"tf-q1-section-optical","v":"mark-detected"},{"k":"tf-q1-number-optical","v":"mark-detected"},{"k":"tf-q1-mark-optical","v":"mark-detected"},{"k":"tf-q2-section-optical","v":""},{"k":"tf-q2-number-optical","v":""},{"k":"tf-q2-mark-optical","v":""},{"k":"tf-page-ok-optical","v":"mark-detected"}],"comments":null}]}</gradex-pagedata><hash>2840385354</hash>`
)

func TestGoodLinkCheck(t *testing.T) {

	pdMap := getPageDataMapFromText(text)

	_, err := GetLinkMap(pdMap)

	assert.NoError(t, err)

}

func TestGoodLinkMap(t *testing.T) {

	pdMap := getPageDataMapFromText(text)

	linkMap, err := GetLinkMap(pdMap)

	assert.NoError(t, err)

	first := "b01b97ff-1e10-4808-b5bc-e36685337e80"
	last := "8ec83f14-97f1-41d6-b031-3238c2016825"

	expectedSequence := []string{
		first,
		"eaae8aff-8d23-47d5-8841-8563565b5de3",
		"79c6eeb2-5589-4a91-9edf-1d6b074625db",
		last,
	}

	assert.Equal(t, first, linkMap[0].First)
	assert.Equal(t, last, linkMap[0].Last)
	assert.Equal(t, expectedSequence, linkMap[0].Sequence)
	assert.Equal(t, true, linkMap[0].IsLinked)
	assert.Equal(t, true, linkMap[1].IsLinked)
	assert.Equal(t, true, linkMap[2].IsLinked)
}

func TestBadLinkMap(t *testing.T) {

	pdMap := getPageDataMapFromText(text)

	//break the link on first Page
	// shrinks the sequence that is reported back
	// throws an error
	// makes IsLinked false for the first page
	pd0 := pdMap[0]

	pd0.Current.Follows = "ThisIsNotAUUID"

	pdMap[0] = pd0

	linkMap, err := GetLinkMap(pdMap)

	assert.Error(t, err) //throws error on badmap
	first := "ThisIsNotAUUID"
	last := "8ec83f14-97f1-41d6-b031-3238c2016825"

	expectedSequence := []string{
		first,
		last,
	}

	assert.Equal(t, first, linkMap[0].First)
	assert.Equal(t, last, linkMap[0].Last)
	assert.Equal(t, expectedSequence, linkMap[0].Sequence)
	assert.Equal(t, false, linkMap[0].IsLinked)

	assert.Equal(t, true, linkMap[1].IsLinked)
	assert.Equal(t, true, linkMap[2].IsLinked)
}
